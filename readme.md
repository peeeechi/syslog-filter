# Syslog Filter App - Unified & Enhanced

## 概要

このプロジェクトは、既存の `peeeechi/syslog-filter` アプリケーションをベースに、**元の `app.py` ファイルに一切変更を加えることなく**、より統一された設計と強化された機能を提供するために再構築されました。Syslogファイルを効率的にフィルタリング・抽出・分析できる、モジュール化されたWebアプリケーションです。

## 主な機能

### 1. データ読み込みの一元化
- **柔軟なファイルアップロード**: `.log` および `.txt` ファイルに加え、`.zip` 形式の圧縮ファイルのアップロードをサポートします。
- **自動アーカイブ展開**: アップロードされた `.zip` ファイルと、その中に含まれる **`.zst` (Zstandard) 圧縮ログファイル**を自動で展開します。
- **スマートなログファイル選択**: 展開されたアーカイブ内に `.log` ファイルが1つのみの場合は自動で読み込み、複数ある場合はドロップダウンリストから選択できます。
- **読み込みデータ共有**: 一度読み込んだログデータは、アプリケーション内の全ての分析ページで共通して利用され、複数回アップロードする手間を省きます。

### 2. キーワードフィルタリング (オリジナル機能の忠実な再現)
- オリジナルアプリケーションの高度なキーワードフィルタリング機能を完全に再現。
- 複数のキーワード入力フィールド、**AND/OR 論理演算子**、動的なフィルタ追加/削除に対応。
- ログメッセージ、ホスト名、アプリ名に対して柔軟な検索が可能。
- **表示行数のカスタマイズ**: 結果表示の最大行数をスライダーで調整できます。
- **フィルタリング結果のCSVダウンロード**。

### 3. 日付/時刻抽出 (新規機能)
- **開始日と終了日による範囲指定**: ログデータ内に存在する日付の範囲内で、分析したい開始日と終了日をそれぞれ指定できます。
- **時刻範囲の指定**: **5分刻みの時間粒度**で、開始時刻と終了時刻を指定し、特定の時間範囲内のログを抽出できます。
- 抽出されたログデータを**CSV形式**または**元のSyslog形式に近いLOG形式**のいずれかでダウンロードできます。
- **表示行数のカスタマイズ**: 結果表示の最大行数をスライダーで調整できます。

### 4. アプリケーションの基盤と利便性
- **モジュール化されたアプリケーション構造**: `src/main_app.py` (エントリーポイント)、`src/app_pages/` (各機能ページ)、`src/utils/` (再利用可能なヘルパー関数) に明確に分離されています。
- **単一コマンドでの起動**: プロジェクトのルートディレクトリから `streamlit run src/main_app.py` を実行するだけで全ての機能にアクセス可能。
- **堅牢なモジュールインポート**: `main_app.py` がプロジェクトルートをPythonパスに自動的に追加するため、モジュールインポートがより安定しています。
- **グローバル一時ファイルクリーンアップ**: アップロードおよび展開プロセスで作成された一時ディレクトリ (`temp_syslog_upload`) と関連するセッションデータを、サイドバーのボタンから完全に削除できます。

## セットアップと実行方法

### 前提条件
- Git
- Python 3.8+
- pip (Pythonパッケージインストーラ)

### インストール
1.  **リポジトリをクローンする (またはあなたのフォークをクローン):**
    ```bash
    git clone [https://github.com/peeeechi/syslog-filter.git](https://github.com/peeeechi/syslog-filter.git)
    cd syslog-filter
    ```
    *(もしフォークしている場合は、`peeeechi` をあなたのGitHubユーザー名に置き換えてください。)*

2.  **依存関係をインストールする:**
    ```bash
    pip install -r requirements.txt
    ```

### アプリケーションの実行
`syslog-filter` ディレクトリにいる状態で、以下のコマンドを実行します。
```bash
streamlit run src/main_app.py
```

### ファイル構造
```
syslog-filter/
├── requirements.txt            # Pythonの依存関係リスト
├── .gitignore                  # Git管理から除外するファイル/ディレクトリ
└── src/                        # 主要なアプリケーションコードを格納するディレクトリ
    ├── __init__.py             # src ディレクトリをPythonパッケージとして認識させるためのファイル
    ├── main_app.py             # アプリケーションの新しいエントリーポイントとナビゲーションロジック
    ├── app.py                  # オリジナルの app.py (本プロジェクトのコード変更は加えていません)
    ├── app_pages/              # 各機能を独立したモジュールとして管理するディレクトリ
    │   ├── __init__.py
    │   ├── upload_data_page.py   # 全てのファイルアップロードとデータ処理を担当するページ
    │   ├── existing_filter_page.py # キーワードフィルタリング機能のページ (オリジナル機能の再現)
    │   ├── datetime_extract_page.py # 日付/時刻抽出機能のページ
    │   └── about_page.py         # アプリケーション情報ページ
    └── utils/                  # 再利用可能なヘルパー関数群
        ├── __init__.py
        ├── file_handlers.py    # ZIP/ZST展開やファイル処理ロジック
        └── log_parser_utils.py # Syslogのパースユーティリティ
```